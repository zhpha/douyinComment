# 抖音直播评论提取插件 (Douyin Live Comment Extractor)

这是一个功能强大的 Chrome / Edge 浏览器插件，用于实时提取抖音直播间的评论、通知和动态消息，并将数据保存到本地数据库中。插件提供了独立的可视化界面来查看、筛选和导出数据。

## ✨ 主要功能

- **实时提取**: 自动监听直播间 DOM 变化，抓取新评论。
- **智能适配**:
  - 支持 **虚拟列表** (Virtual Scrolling): 能够检测节点复用 (`data-index` 变化)。
  - **自动重连**: 当页面刷新或评论区容器被移除/替换时，插件自动搜索新容器重新挂载监听。
- **多类型支持**: 区分普通评论、系统通知、底部动态。
- **数据管理 (Viewer)**:
  - 独立的**数据查看器**页面。
  - **多维度筛选**: 按直播间、消息类型（多选）、时间范围、关键词搜索。
  - **数据导出**: 支持导出 JSON 和 CSV 格式（自动处理 UTF-8 BOM 防止乱码）。
  - **数据清理**: 支持删除指定直播间数据或清空所有数据。

## 📂 目录结构

- `manifest.json`: 插件核心配置文件 (MV3)。
- `content.js`: 注入到直播间页面的脚本，负责 DOM 监听与解析。
- `background.js`: 后台 Service Worker，负责 IndexedDB 数据库读写。
- `popup.html` / `js`: 点击浏览器插件图标时的控制面板（开始/停止）。
- `viewer.html` / `js`: 完整的数据查看与管理后台。

## 🚀 安装与使用

### 安装插件
1. 打开 Chrome/Edge 浏览器，进入 **扩展程序** 页面 (`chrome://extensions/` 或 `edge://extensions/`)。
2. 开启右上角的 **开发者模式**。
3. 点击 **加载已解压的扩展程序**。
4. 选择本项目所在的文件夹 (`f:\抖音评论区`)。

### 提取评论
1. 打开任意抖音直播间页面 (`live.douyin.com/...`)。
2. 刷新页面以确保插件脚本加载。
3. 点击浏览器右上角的插件图标，点击 **Start** 开始提取。
4. 插件会自动抓取评论，你可以在 Popup 面板看到“已提取 X 条”。

### 查看与导出数据
1. 在插件 Popup 面板中，点击 **View Data (查看数据)** 按钮（或者直接打开 `viewer.html`）。
2. 在打开的**评论数据查看器**页面中：
   - **筛选**: 
     - 下拉选择特定的直播间。
     - 使用多选框组合筛选评论类型（评论/通知/动态）。
     - 设置起止时间或输入关键词搜索。
   - **导出**: 点击列表下方的 **导出 JSON** 或 **导出 CSV**。
   - **删除**: 
     - 点击右上角的 **⋮** 按钮。
     - 选择 **删除当前直播间** (需先筛选特定直播间)。
     - 选择 **清空所有数据** (慎用)。

## 🛠️ 常见问题

**Q: 点击“开始”后没有抓取到数据？**
- 检查控制台 (`F12` -> Console) 是否有日志输出 "开始提取评论..."。
- 可能是页面结构更新导致选择器失效。插件目前使用多种兜底策略寻找容器，如果失效请查看控制台警告。

**Q: 为什么有些评论抓取不到？**
- 插件依赖 MutationObserver 监听 DOM。如果消息刷屏过快，浏览器可能会合并 DOM 变动，或者虚拟列表复用过快导致部分遗漏，但插件已针对复用节点 (`attributes: true`) 做了优化处理。

**Q: 数据存储在哪里？**
- 数据保存在浏览器的 **IndexedDB** 本地数据库中，不会上传到任何服务器，隐私安全。

## 📝 开发说明

如果需要修改抓取逻辑，主要关注 `content.js` 中的 `processCommentNode` 函数和 `setupObserver` 函数。

- `setupObserver`: 负责挂载 MutationObserver，包含轮询检测容器失效的保活机制。
- `processCommentNode`: 负责解析单个 DOM 节点的文本、昵称、等级等信息。
